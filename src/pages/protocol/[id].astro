---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
	const posts = await getCollection('protocol');
	return posts.map((post) => ({
		params: { id: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content } = await render(post);

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Studio Home",
      "item": "https://dojjjo.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Protocol",
      "item": "https://dojjjo.com/protocol"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": post.data.title,
      "item": `https://dojjjo.com/protocol/${post.id}`
    }
  ]
};
---

<Layout title={post.data.title} description={post.data.description}>
	<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} is:inline slot="head" />
	<article class="container animate-fade-in">
		<header class="article-header">
			<p class="section-meta">{post.data.pubDate.toLocaleDateString()}</p>
			<h1 class="text-gradient">{post.data.title}</h1>
			<p class="subtitle">{post.data.description}</p>
		</header>
		
		<hr class="tech-line line-h" style="margin: 2rem 0; opacity: 0.1;" />
		
		<div class="prose">
			<Content />
		</div>

		<footer class="article-footer v-stack" style="gap: var(--space-md);">
			<div class="cta-box surface">
				<p class="section-meta" style="margin-bottom: 0.5rem;">READY_TO_DEPLOY</p>
				<h3>Initialize the Protocol</h3>
				<p style="color: var(--color-text-secondary); margin-bottom: 1.5rem;">We deploy these assets as part of the DOJJJO Authority Loop flagship offering.</p>
				<a href="/audit" class="btn btn-primary">Run Readiness Audit</a>
			</div>
			<div class="cta-box secondary">
				<p class="text-secondary" style="font-size: 0.8rem; font-family: monospace;">ASSET_TYPE: {post.data.tags?.join(' // ') || 'TECHNICAL_PROTOCOL'}</p>
			</div>
		</footer>
	</article>
</Layout>

<style>
	article { padding: var(--space-xl) 0; max-width: 800px; }
	.article-header { margin-bottom: var(--space-lg); }
	.subtitle { font-size: 1.25rem; color: var(--color-text-secondary); margin-top: 1rem; line-height: 1.6; }

	.prose { line-height: 1.8; font-size: 1.1rem; color: #ccc; }
	.prose :global(h2) { margin-top: 3rem; color: var(--color-accent); font-size: 1.75rem; }
	.prose :global(h3) { margin-top: 2rem; color: #fff; font-size: 1.4rem; }
	.prose :global(p) { margin-bottom: 1.5rem; }
	.prose :global(code) { background: rgba(255,255,255,0.05); padding: 0.2rem 0.4rem; border-radius: 4px; color: var(--color-accent); font-family: monospace; font-size: 0.9em; }

	.article-footer { margin-top: var(--space-2xl); }
	.cta-box { padding: var(--space-xl); border-radius: 12px; text-align: center; }
    .cta-box.secondary { border: none; background: transparent; opacity: 0.5; }
</style>
