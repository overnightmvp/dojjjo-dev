---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
	const posts = await getCollection('protocol');
	return posts.map((post) => ({
		params: { id: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content } = await render(post);

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://caption.ai"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Protocol",
      "item": "https://caption.ai/protocol"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": post.data.title,
      "item": `https://caption.ai/protocol/${post.id}`
    }
  ]
};
---

<Layout title={post.data.title} description={post.data.description}>
	<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} is:inline slot="head" />
	<article class="container animate-fade-in">
		<header class="article-header">
			<p class="text-accent">{post.data.pubDate.toLocaleDateString()}</p>
			<h1 class="text-gradient">{post.data.title}</h1>
			<p class="subtitle">{post.data.description}</p>
		</header>
		
		<hr class="tech-line line-h" style="margin: 2rem 0; opacity: 0.1;" />
		
		<div class="prose">
			<Content />
		</div>

		<footer class="article-footer v-stack" style="gap: var(--space-md);">
			<div class="cta-box">
				<h3>Need an AI Authority Audit?</h3>
				<p>We'll analyze your entity mapping and show you where the gaps are.</p>
				<a href="/audit" class="btn btn-primary">Audit My Brand</a>
			</div>
			<div class="cta-box secondary">
				<p class="text-secondary" style="font-size: 0.9rem;">Part of the <a href="/roadmap" class="text-accent">S-Tier Business Roadmap</a></p>
			</div>
		</footer>
	</article>
</Layout>

<style>
	article {
		padding: var(--space-xl) 0;
		max-width: 800px;
	}

	.article-header {
		margin-bottom: var(--space-lg);
	}

	.subtitle {
		font-size: 1.25rem;
		color: var(--color-text-secondary);
		margin-top: 1rem;
	}

	.prose {
		line-height: 1.8;
		font-size: 1.125rem;
		color: var(--color-text-primary);
	}

	.prose :global(h2) {
		margin-top: 3rem;
		color: var(--color-accent);
	}

	.prose :global(h3) {
		margin-top: 2rem;
		color: #fff;
	}

	.prose :global(p) {
		margin-bottom: 1.5rem;
	}

	.prose :global(code) {
		background: var(--color-surface);
		padding: 0.2rem 0.4rem;
		border-radius: 4px;
		color: var(--color-accent);
		font-family: monospace;
	}

	.article-footer {
		margin-top: var(--space-xl);
	}

	.cta-box {
		background: var(--color-surface);
		padding: var(--space-lg);
		border: 1px solid var(--color-border);
		border-radius: 8px;
		text-align: center;
	}
</style>
